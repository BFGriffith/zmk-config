name: Build ZMK firmware
on: [push, pull_request, workflow_dispatch]

# jobs:
  # build:
    # uses: zmkfirmware/zmk/.github/workflows/build-user-config.yml@main
    # uses: zmkfirmware/zmk/.github/workflows/build-user-config.yml@v0.3
jobs:
  build:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/zmkfirmware/zmk:main

    steps:
      - uses: actions/checkout@v4
        with:
          submodules: recursive  # Ensure ZMK submodule is properly cloned

      - name: Install dependencies
        run: |
          apt-get update
          apt-get install -y git python3 python3-pip python3-venv libmicrodns-dev
          pip install --upgrade pip setuptools wheel

      - name: Build firmware
        env:
          ZMK_BOARD: cyboard_imprint  # Explicitly specify the board target
          ZMK_SHIELD: base  # Use appropriate shield if needed
        run: |
          make clean
          make

      - name: Upload artifacts
        uses: actions/upload-artifact@v3
        with:
          name: zmk-firmware
          path: |
            build/zmk.uf2
            build/zmk.bin

